<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width" />
</head>
<body>
  <div id="test"></div>
<canvas id="myCanvas" width="320" height="240" style="border:1px solid #d3d3d3;">
Use different browser.
</canvas>
<script>
//
// javascript objects can not handle arrays inside themselfs if
// you create multiple instances of these. they start overwriting
// themselfs with eachother.
//
// here i use classes now. these need to have their
// objects or arrays inside them initialised in the
// constructor part. if not then no work.
//

	var c=document.getElementById("myCanvas");
	var ctx=c.getContext("2d");
	var debug=0;
	class  point {
    	// line,defensivecircle,fingerfour,twoabreast
    	type = 'defensivecircle';
		// angle of the formation. used
		// to build the positions.
		angle=0;
 		centerx=0;
		centery=0;
		// holds the formation positions.
		//x=[];
		//y=[];
    	// angles direction facing of soldier
    	//angles=[];
		constructor() {
    		this.x = [];
			this.y = [];
			this.angles = [];
  		}
		addleader(x,y){
			this.centerx = x;
			this.centery = y;
			this.x[0]=(x+32);
			this.y[0]=(y);
		}
		// add a slot to the formation if possible
		addslot(){
			if(this.x.length>3)return; // max = 4
			
			var x1=0;
			var y1=0;

      if(this.type=='line'){
    		x1=this.x[0]+(Math.cos(this.angle)*(this.x.length*16));
			y1=this.y[0]+(Math.sin(this.angle)*(this.x.length*16));
      	this.angles.push(0);
			this.x.push(x1);
			this.y.push(y1);
      }
      if(this.type=='defensivecircle'){
      	var step=(Math.PI*2)/4;
      	var i=this.x.length;
        	x1=this.centerx+(Math.cos(this.angle+i*step)*16);
			y1=this.centery+(Math.sin(this.angle+i*step)*16);
      	
			this.x.push(x1);
			this.y.push(y1);
      }
  	}
		// update the positions if rotated and such.
		update(){
			if(this.type=='line'){
				for(var i=1;i<this.x.length;i++){
					this.x[i]=this.x[0]+(Math.cos(this.angle)*(i*16));
					this.y[i]=this.y[0]+(Math.sin(this.angle)*(i*16));
				}
			}
			if(this.type=='defensivecircle'){
      	var step=(Math.PI*2)/4;
      		for(var i=0;i<4;i++){
        			this.x[i]=this.centerx+(Math.cos(this.angle+i*step)*16);
					this.y[i]=this.centery+(Math.sin(this.angle+i*step)*16);
      		}
			//this.x.push(x1-32);
			//this.y.push(y1);
			
			}
		}
		draw(){
			ctx.globalAlpha = 0.5;
			for(var z=0;z<this.x.length;z++){
				if(z==0){
				ctx.fillStyle = 'yellow';
				}else{
				ctx.fillStyle = 'white';
				}
				ctx.beginPath()
				ctx.arc(this.x[z],this.y[z],6,0,6);
				ctx.fill();
			}
		}
	};
	myCanvas.height = window.innerHeight-32;
	myCanvas.width = window.innerWidth-32;

	var groups = [];
	for(var i=0;i<3;i++){
		var obj = new point();
		obj.type = 'line';
		if(i % 2==0)obj.type='defensivecircle';
		obj.addleader(i*150+100,200);
		obj.addslot();
		obj.addslot();
		obj.addslot();
		groups.push(obj);
	}
//debug = groups[0].x.length;
 

	gameloop=setInterval(doGameLoop,16);





	function doGameLoop(){
		myCanvas.height = window.innerHeight-32;
		myCanvas.width = window.innerWidth-32;
		ctx.fillStyle="rgb(0,0,0)";
		ctx.fillRect(0,0,c.width,c.height);
		ctx.fillStyle="rgb(255,255,255)";
		ctx.fillText("Formations."+debug,10,10); 

		for(i=0;i<groups.length;i++){
			groups[i].angle+=.01;
			groups[i].update();
			groups[i].draw();
		}

		//formation1.angle +=.05;
		//formation1.update();
		//formation1.draw();

		//formation2.angle +=.05;
		//formation2.update();
		//group1.draw();

	}
</script>
</body>
</html>







