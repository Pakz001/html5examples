<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width" />
</head>
<body>
  <div id="test"></div>
<canvas id="myCanvas" width="320" height="240" style="border:1px solid #d3d3d3;">
Use different browser.
</canvas>
  <script>
    //
    // create tile map. all isometric. populous amiga.

   var c=document.getElementById("myCanvas");
   var ctx=c.getContext("2d");
	var touchx = 0;
	var touchy = 0;
   var tileselected = 0;
   var map = new Array();
 	c.addEventListener("touchstart", touchHandler);
	c.addEventListener("touchmove", touchHandler);
	c.addEventListener("touchend", touchHandler);
	showtiles = false;
	gameloop=setInterval(doGameLoop,16);
   for (x=0;x<10;x++) {
 	for (var y=0;y<48;y++) {
	  settile(x,y,Math.floor(Math.random()*16));
 	}
	}

function doGameLoop(){
	myCanvas.width = window.innerWidth;
	myCanvas.height = window.innerHeight-32;
	myCanvas.width = window.innerWidth-32;
	clearscreen();
	drawtext("Populous(amiga) tiles.",10,10);
  	ctx.fillText("touch bottom for tile select.",myCanvas.width*.65,10);   

   // draw selected tile from set
   ctx.save();
   ctx.translate(myCanvas.width/2,0)
   ctx.scale(.5,.5)
   tile(0,0,tileselected);
   ctx.restore();

	// show and select tiles.
   if(showtiles){
   	cnt = 0;
   	w = myCanvas.width-64;
   	h = myCanvas.height-32;
   	for( y=32;y<h;y+=33){
   	for( x=0;x<w;x+=80){
     		tile(x,y,cnt);
     		cnt=cnt+1;
   	}}
	}

   /// draw isometric map
   sw = 0;
   for(y=0;y<48;y++){
   for(x=0;x<10;x++){
     dx = x*61;
     dy = y*10;
     if(sw==1)dx+=31;
     if(map[x]!=undefined && map[x][y]!=undefined){
     tile(dx,dy,map[x][y]);
}
   }
   if(sw==0){
     sw=1;
   }else{
     sw=0;
   }}

}
function touchHandler(e) {
	if(e.type=="touchstart" && e.touches) {
		const touches = e.changedTouches;
		touchx = touches[0].pageX;
		touchy = touches[0].pageY;
		if(touchy>myCanvas.height-100)showtiles=true;
		e.preventDefault();
	}
	if(e.type=="touchend" && e.touches) {
		showtiles=false;
   	e.preventDefault();
	}
	if(e.type=="touchmove" && e.touches) {
		const touches = e.changedTouches;
		touchx = touches[0].pageX;
		touchy = touches[0].pageY;
   	e.preventDefault();
	}
}


function tile(x,y,tile){
// the edges and isometric points
// of interest. modify for scale

	var 
bottom=31,top=0,right=63,left=0,low1=bottom-bottom/3,center=right/2,high1=bottom/3;
  	ctx.save();
  	ctx.translate(x,y);

//if(touchy>64 && rectsoverlap(touchx,touchy-32,1,1,x,y,right,bottom)==true){
   tileselected = tile;
  	//setcolor('white');
//	}else{
  	//setcolor('darkslategrey');
	//}
  	//ctx.fillRect(0,0,65,33);
	//setcolor('white');
  	//drawrect(0,0,65,33);
	//setcolor('white');
  	//drawtext(tile,70,16);
  	//x+=2;y+=1;
	
  if(tile==15){
		setcolor('lightgrey');
		ctx.beginPath();
		ctx.moveTo(center, top);
   	ctx.lineTo(left, high1);
   	ctx.lineTo(center, low1);
   	ctx.fill();
		ctx.beginPath();
		ctx.moveTo(center, top);
   	ctx.lineTo(right, high1);
   	ctx.lineTo(center, low1);
   	ctx.fill();
		setcolor('dimgrey');
		ctx.beginPath();
		ctx.moveTo(right-3, high1);
   	ctx.lineTo(center,low1);
      ctx.lineTo(center,bottom);
   	ctx.lineTo(right, low1);
		ctx.lineTo(right,high1);
   	ctx.fill();
	   setcolor('grey');
		ctx.beginPath();
		ctx.moveTo(left, high1);
   	ctx.lineTo(center,low1);
   	ctx.lineTo(center, bottom);
	   ctx.lineTo(left, low1);
      ctx.fill();
	}
 if(tile==14){
	   setcolor('grey');
		ctx.beginPath();
		ctx.moveTo(left, high1);
   	ctx.lineTo(center,low1);
   	ctx.lineTo(center, bottom);
	   ctx.lineTo(left, low1);
      ctx.fill();
	   setcolor('dimgrey');
		ctx.beginPath();
		ctx.moveTo(right,high1);
      ctx.lineTo(right,low1);
   	ctx.lineTo(center,bottom);
   	ctx.lineTo(center, low1);
      ctx.fill();
		setcolor('lightgrey');
		ctx.beginPath();
		ctx.moveTo(left, high1);
   	ctx.lineTo(center,high1);
      ctx.lineTo(center,low1);
   	ctx.fill();
		setcolor('white');
		ctx.beginPath();
		ctx.moveTo(center, high1);
   	ctx.lineTo(right,high1);
      ctx.lineTo(center,low1);
   	ctx.fill();
  }
  if(tile==13){
	   setcolor('grey');
		ctx.beginPath();
		ctx.moveTo(left, high1);
   	ctx.lineTo(center,low1);
   	ctx.lineTo(center, bottom);
	   ctx.lineTo(left, low1);
      ctx.fill();
	   setcolor('dimgrey');
		ctx.beginPath();
		ctx.moveTo(right,low1);
   	ctx.lineTo(center,bottom);
   	ctx.lineTo(center, low1);
      ctx.fill();
		setcolor('lightgrey');
		ctx.beginPath();
		ctx.moveTo(left, high1);
   	ctx.lineTo(center,top);
   	ctx.lineTo(right, low1);
      ctx.lineTo(center,low1);
   	ctx.fill();
	   setcolor('grey');
		ctx.beginPath();
		ctx.moveTo(left, high1);
   	ctx.lineTo(right*.6,bottom*.6);
   	ctx.lineTo(right, low1);

   	ctx.fill();
  }
  if(tile==12){
	   setcolor('grey');
		ctx.beginPath();
		ctx.moveTo(left, high1);
   	ctx.lineTo(center,low1);
   	ctx.lineTo(center, bottom);
	   ctx.lineTo(left, low1);
      ctx.fill();
	   setcolor('dimgrey');
		ctx.beginPath();
		ctx.moveTo(right,low1);
   	ctx.lineTo(center,bottom);
   	ctx.lineTo(center, low1);
      ctx.fill();
		setcolor('lightgrey');
		ctx.beginPath();
		ctx.moveTo(left, high1);
   	ctx.lineTo(center,high1);
   	ctx.lineTo(right, low1);
      ctx.lineTo(center,low1);
   	ctx.fill();
  }
  if(tile==11){
		setcolor('lightgrey');
		ctx.beginPath();
		ctx.moveTo(left, high1);
   	ctx.lineTo(center,top);
		ctx.lineTo(center,bottom);
   	ctx.fill();
		setcolor('grey');
		ctx.beginPath();
		ctx.moveTo(left+3, high1);
   	ctx.lineTo(center,bottom);
   	ctx.lineTo(left, low1);
		ctx.lineTo(left,high1);
   	ctx.fill();
	   setcolor('white');
		ctx.beginPath();
		ctx.moveTo(center, top);
   	ctx.lineTo(center, bottom);
      ctx.lineTo(right,high1);
   	ctx.fill();
		setcolor('dimgrey');
		ctx.beginPath();
		ctx.moveTo(right-3, high1);
   	ctx.lineTo(center,bottom);
      ctx.lineTo(center,bottom);
   	ctx.lineTo(right, low1);
		ctx.lineTo(right,high1);
   	ctx.fill();
  }
  if(tile==10){
	   setcolor('lightgrey');
		ctx.beginPath();
		ctx.moveTo(left, high1);
   	ctx.lineTo(right,high1);
   	ctx.lineTo(center, bottom);
      ctx.fill();
	   setcolor('dimgrey');
		ctx.beginPath();
		ctx.moveTo(right-3, high1);
   	ctx.lineTo(center,bottom);
   	ctx.lineTo(right, low1);
		ctx.lineTo(right,high1);
      ctx.fill();
		setcolor('grey');
		ctx.beginPath();
		ctx.moveTo(left+3, high1);
   	ctx.lineTo(center,bottom);
   	ctx.lineTo(left, low1);
		ctx.lineTo(left,high1);
   	ctx.fill();
  }
  
  if(tile==9){
		setcolor('lightgrey');
		ctx.beginPath();
		ctx.moveTo(left, high1);
   	ctx.lineTo(center,top);
   	ctx.lineTo(right, low1);
		ctx.lineTo(center,bottom);
   	ctx.fill();

		setcolor('grey');
		ctx.beginPath();
		ctx.moveTo(left+3, high1);
   	ctx.lineTo(center,bottom);
   	ctx.lineTo(left, low1);
		ctx.lineTo(left,high1);
   	ctx.fill();
  }

  if(tile==8){
		setcolor('grey');
		ctx.beginPath();
		ctx.moveTo(left, high1);
   	ctx.lineTo(left, low1);
   	ctx.lineTo(center, bottom);
   	ctx.fill();
		setcolor('lightgrey');
		ctx.beginPath();
		ctx.moveTo(left, high1);
   	ctx.lineTo(center, high1);
   	ctx.lineTo(right, low1);
  	   ctx.lineTo(center, bottom);
   	ctx.fill();
      setcolor('grey');
		ctx.beginPath();
		ctx.moveTo(left, high1);
   	ctx.lineTo(center, bottom*.4);
      ctx.lineTo(right, low1);
   	ctx.fill();
   }
	if(tile==7){
		setcolor('white');
		ctx.beginPath();
		ctx.moveTo(center, top);
   	ctx.lineTo(left, low1);
   	ctx.lineTo(center, low1);
      ctx.lineTo(right,high1);
   	ctx.fill();
      setcolor('grey');
		ctx.beginPath();
		ctx.moveTo(left, low1);
   	ctx.lineTo(center, bottom);
   	ctx.lineTo(center, low1);
   	ctx.fill();
		setcolor('dimgrey');
		ctx.beginPath();
		ctx.moveTo(right-3, high1);
   	ctx.lineTo(center,low1);
      ctx.lineTo(center,bottom);
   	ctx.lineTo(right, low1);
		ctx.lineTo(right,high1);
   	ctx.fill();
      setcolor('grey');
		ctx.beginPath();
		ctx.moveTo(right-3, high1);
   	ctx.lineTo(left,low1);
      ctx.lineTo(center,(low1+high1)/2);
      ctx.fill();
	}
	if(tile==6){
		setcolor('white');
		ctx.beginPath();
		ctx.moveTo(center, high1);
   	ctx.lineTo(left, low1);
   	ctx.lineTo(center, low1);
      ctx.lineTo(right,high1);
   	ctx.fill();
      setcolor('grey');
		ctx.beginPath();
		ctx.moveTo(left, low1);
   	ctx.lineTo(center, bottom);
   	ctx.lineTo(center, low1);
   	ctx.fill();
		setcolor('dimgrey');
		ctx.beginPath();
		ctx.moveTo(right-3, high1);
   	ctx.lineTo(center,low1);
      ctx.lineTo(center,bottom);
   	ctx.lineTo(right, low1);
 
		ctx.lineTo(right,high1);
   	ctx.fill();
	}
   if(tile==5){
		setcolor('white');
		ctx.beginPath();
		ctx.moveTo(center, top);
   	ctx.lineTo(left, low1);
   	ctx.lineTo(center, low1);
   	ctx.fill();
      setcolor('grey');
		ctx.beginPath();
		ctx.moveTo(left, low1);
   	ctx.lineTo(center, low1);
   	ctx.lineTo(center, bottom);
   	ctx.fill();
      setcolor('lightgrey');
		ctx.beginPath();
		ctx.moveTo(center, top);
   	ctx.lineTo(center, low1);
   	ctx.lineTo(right, low1);
   	ctx.fill();
     setcolor('dimgrey');
		ctx.beginPath();
		ctx.moveTo(center, low1);
   	ctx.lineTo(center, bottom);
   	ctx.lineTo(right, low1);
   	ctx.fill();
   }
   if(tile==4){
		setcolor('white');
		ctx.beginPath();
		ctx.moveTo(center, high1);
   	ctx.lineTo(left, low1);
   	ctx.lineTo(center, low1);
   	ctx.fill();
      setcolor('grey');
		ctx.beginPath();
		ctx.moveTo(left, low1);
   	ctx.lineTo(center, low1);
   	ctx.lineTo(center, bottom);
   	ctx.fill();
      setcolor('lightgrey');
		ctx.beginPath();
		ctx.moveTo(center, high1);
   	ctx.lineTo(center, low1);
   	ctx.lineTo(right, low1);
   	ctx.fill();
     setcolor('dimgrey');
		ctx.beginPath();
		ctx.moveTo(center, low1);
   	ctx.lineTo(center, bottom);
   	ctx.lineTo(right, low1);
   	ctx.fill();
   }
	if(tile==3){
		setcolor('white');
		ctx.beginPath();
		ctx.moveTo(center, top);
   	ctx.lineTo(left, low1);
   	ctx.lineTo(center, bottom);
   	ctx.fill();
		ctx.beginPath();
		ctx.moveTo(center, top);
   	ctx.lineTo(right, high1);
   	ctx.lineTo(center, bottom);
   	ctx.fill();
		setcolor('dimgrey');
		ctx.beginPath();
		ctx.moveTo(right-3, high1);
   	ctx.lineTo(center,bottom);
   	ctx.lineTo(right, low1);
		ctx.lineTo(right,high1);
   	ctx.fill();
	}
	if(tile==2){
		setcolor('white');
		ctx.beginPath();
		ctx.moveTo(center, high1);
   	ctx.lineTo(left, low1);
   	ctx.lineTo(center, bottom);
   	ctx.fill();
		ctx.beginPath();
		ctx.moveTo(center, high1);
   	ctx.lineTo(right, high1);
   	ctx.lineTo(center, bottom);
   	ctx.fill();
		setcolor('dimgrey');
		ctx.beginPath();
		ctx.moveTo(right-3, high1);
   	ctx.lineTo(center,bottom);
   	ctx.lineTo(right, low1);
		ctx.lineTo(right,high1);
      ctx.fill();
      setcolor('grey');
      ctx.beginPath();
      ctx.moveTo(right-3, high1);
   	ctx.lineTo(left,low1);
   	ctx.lineTo(center, (low1+high1)/2);
		//ctx.lineTo(right,high1);
   	ctx.fill();
	}

	if(tile==1){
		setcolor('white');
		ctx.beginPath();
		ctx.moveTo(center, top);
   	ctx.lineTo(center, bottom);
   	ctx.lineTo(left, low1);
   	ctx.fill();
		setcolor('lightgrey')
 		ctx.beginPath();
		ctx.moveTo(center, top);
   	ctx.lineTo(center, bottom);
   	ctx.lineTo(right, low1);
   	ctx.fill();
	}

  if(tile==0){
	   setcolor('white');
		ctx.beginPath(); 
      ctx.moveTo(center, high1);
      ctx.lineTo(right, low1);
      ctx.lineTo(center, bottom);
      ctx.lineTo(left, low1);
      ctx.fill();
  }
	ctx.restore();
}
function drawrect(x,y,w,h){
ctx.beginPath();
ctx.strokeStyle='white';
ctx.rect(x,y,w,h);
ctx.stroke();
}
function setcolor(col){
	ctx.fillStyle=col;
}
function drawtext(txt,x,y){
	ctx.fillStyle='white';
	ctx.fillText(txt,x,y); 
}
function clearscreen(){
	ctx.fillStyle="rgb(0,0,0)";
	ctx.fillRect(0,0,c.width,c.height);
}
function rectsoverlap(x1,y1,w1,h1,x2,y2,w2,h2){
		return 	x1 <= x2+w2
			&& 	x2 <= x1+w1
			&&	y1 <= y2+h2
			&&	y2 <= y1+h1;
	}
		// Set a tile and create slot in memory if there is nothing
		// there yet.
		function settile(x,y,val){
			if(map[x]==undefined){
 				map[x]=new Array();
			}
			map[x][y]=val;
		}
</script>
</body>
</html>
